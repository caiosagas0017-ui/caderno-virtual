<!DOCTYPE html>
<html lang="pt-PT">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Caderno Inteligente ‚ú®</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;600;700&family=Merriweather:ital,wght@0,300;0,400;0,700;1,400&family=Nunito:wght@400;600;700&family=Caveat:wght@400;500;600;700&family=Patrick+Hand&family=Dancing+Script:wght@400;700&family=Pacifico&family=Indie+Flower&family=Playfair+Display:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">

    <style>
        /* Fontes */
        .font-ui { font-family: 'Quicksand', sans-serif; }
        .font-serif { font-family: 'Merriweather', serif; }
        .font-sans { font-family: 'Nunito', sans-serif; }
        .font-handwriting { font-family: 'Caveat', cursive; }
        .font-marker { font-family: 'Patrick Hand', cursive; }
        .font-dancing { font-family: 'Dancing Script', cursive; }
        .font-pacifico { font-family: 'Pacifico', cursive; }
        .font-indie { font-family: 'Indie Flower', cursive; }
        .font-playfair { font-family: 'Playfair Display', serif; }

        /* Background Fofo */
        body {
            background-color: #fff0f5; /* Lavender Blush */
            background-image: radial-gradient(#ffb7b2 1.5px, transparent 1.5px), radial-gradient(#ffb7b2 1.5px, transparent 1.5px);
            background-size: 20px 20px;
            background-position: 0 0, 10px 10px;
        }

        /* Scrollbar Cute */
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: transparent;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background-color: #fbcfe8; /* Pink 200 */
            border-radius: 20px;
            border: 2px solid white;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background-color: #f472b6; /* Pink 400 */
        }

        /* Anima√ß√µes */
        @keyframes popIn {
            0% { transform: scale(0.95); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        .animate-pop {
            animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }
    </style>
</head>
<body class="overflow-hidden h-screen w-full flex font-ui text-slate-600">

    <!-- Sidebar -->
    <aside id="sidebar" class="w-full md:w-80 flex-shrink-0 flex flex-col bg-white/90 backdrop-blur-xl border-r-4 border-rose-100 shadow-[4px_0_24px_rgba(0,0,0,0.02)] z-30 h-full absolute md:relative transform -translate-x-full md:translate-x-0 transition-transform duration-300 rounded-r-[3rem] my-2 md:my-0">
        
        <!-- Header Sidebar -->
        <div class="p-6 pb-2">
            <div class="flex items-center gap-4 mb-6">
                <div id="sidebar-icon-container" class="w-14 h-14 rounded-full flex items-center justify-center text-3xl shadow-sm ring-4 ring-rose-50 bg-rose-100 text-rose-500 transition-all duration-500 hover:rotate-12">
                    <span id="app-icon">üéÄ</span>
                </div>
                <div>
                    <h1 class="text-2xl font-pacifico text-rose-500 tracking-wide">Di√°rio</h1>
                    <span class="text-xs font-bold tracking-widest uppercase text-rose-300 bg-rose-50 px-2 py-1 rounded-full">Secret</span>
                </div>
            </div>

            <!-- Search -->
            <div class="relative mb-4 group">
                <i data-lucide="search" class="absolute left-4 top-3.5 w-4 h-4 text-rose-300 group-focus-within:text-rose-500 transition-colors"></i>
                <input type="text" id="search-input" placeholder="Procurar mem√≥rias..." 
                    class="w-full pl-11 pr-4 py-3 bg-rose-50/50 border-2 border-transparent hover:border-rose-100 focus:border-rose-200 rounded-2xl text-sm text-slate-600 placeholder-rose-300 focus:ring-0 transition-all outline-none font-medium">
            </div>

            <button onclick="app.addNote()" class="w-full py-3 px-4 bg-rose-400 hover:bg-rose-500 text-white rounded-2xl flex items-center justify-center gap-2 transition-all shadow-lg shadow-rose-200 hover:shadow-xl hover:shadow-rose-300 hover:-translate-y-0.5 active:translate-y-0 active:scale-95 group">
                <i data-lucide="sparkles" class="w-4 h-4 animate-pulse"></i>
                <span class="font-bold text-sm tracking-wide font-ui">Nova P√°gina</span>
            </button>
        </div>

        <!-- Lista de Notas -->
        <div id="notes-list" class="flex-1 overflow-y-auto px-4 pb-4 space-y-3 custom-scrollbar pt-2">
            <!-- As notas ser√£o inseridas aqui via JS -->
        </div>
        
    </aside>

    <!-- √Årea Principal -->
    <main class="flex-1 flex flex-col h-full relative w-full overflow-hidden">
        
        <!-- Mobile Header Toggle -->
        <div class="md:hidden p-4 flex items-center gap-3 bg-white/60 backdrop-blur-md z-20 sticky top-0">
            <button onclick="app.toggleSidebar()" class="text-rose-400 hover:text-rose-600 transition-colors p-2 bg-white rounded-full shadow-sm">
                <i data-lucide="menu" class="w-6 h-6"></i>
            </button>
            <span class="font-pacifico text-xl text-rose-500">Meu Di√°rio</span>
        </div>

        <!-- Container Vazio -->
        <div id="empty-state" class="hidden flex-1 flex flex-col items-center justify-center p-8 text-center opacity-70 h-full animate-pop">
            <div class="w-32 h-32 bg-white rounded-full flex items-center justify-center shadow-[0_8px_30px_rgb(0,0,0,0.04)] mb-6 ring-8 ring-rose-50">
                <span class="text-6xl">üß∏</span>
            </div>
            <h2 class="text-3xl font-pacifico text-rose-400 mb-3">Ol√°, sonhador(a)!</h2>
            <p class="text-slate-500 max-w-xs font-medium bg-white/50 px-4 py-2 rounded-xl">Escolhe uma p√°gina ao lado para escreveres os teus pensamentos.</p>
        </div>

        <!-- Editor Container -->
        <div id="editor-container" class="flex-1 flex flex-col h-full max-w-5xl mx-auto w-full p-2 md:p-6 lg:p-8 transition-all duration-500">
            
            <!-- Folha de Papel -->
            <div id="paper-sheet" class="flex-1 flex flex-col bg-white rounded-[2.5rem] shadow-[0_20px_60px_-15px_rgba(0,0,0,0.1)] overflow-hidden transition-all duration-500 relative ring-8 ring-white/50">
                
                <!-- Toolbar Flutuante -->
                <div id="toolbar" class="px-6 py-4 flex flex-wrap items-center justify-between gap-4 border-b border-rose-100 bg-white/90 backdrop-blur-sm z-20 sticky top-0">
                    
                    <div class="flex items-center gap-4">
                        <div id="toolbar-icon-bg" class="w-11 h-11 rounded-2xl flex items-center justify-center text-2xl shadow-sm ring-4 ring-rose-50 transition-colors bg-rose-100 text-rose-500">
                            <span id="toolbar-icon">üå∏</span>
                        </div>
                        <div class="flex flex-col">
                            <span id="paper-label" class="text-[10px] font-bold uppercase tracking-wider text-rose-300 bg-rose-50 px-2 py-0.5 rounded-full w-fit">Padr√£o</span>
                            <div class="flex items-center gap-1.5 text-xs font-bold text-slate-400 mt-1">
                                <i data-lucide="clock" class="w-3 h-3"></i>
                                <span id="last-updated">Agora</span>
                            </div>
                        </div>
                    </div>

                    <div class="flex items-center gap-2 bg-rose-50 p-1.5 rounded-2xl">
                        <!-- Menu Personalizar -->
                        <div class="relative">
                            <button onclick="app.toggleAppearanceMenu()" id="btn-personalizar" class="px-4 py-2 rounded-xl transition-all flex items-center gap-2 text-xs font-bold uppercase tracking-wide text-rose-400 hover:bg-white hover:text-rose-600 hover:shadow-sm">
                                <i data-lucide="palette" class="w-4 h-4"></i>
                                <span class="hidden sm:inline">Decorar</span>
                            </button>
                            
                            <!-- Popover Menu Moderno -->
                            <div id="appearance-menu" class="hidden absolute right-0 top-full mt-4 w-80 bg-white rounded-3xl shadow-[0_10px_40px_-10px_rgba(251,113,133,0.3)] border-2 border-rose-100 p-6 z-50 animate-pop">
                                <!-- Preenchido via JS -->
                            </div>
                        </div>

                        <div class="h-5 w-px bg-rose-200 mx-1"></div>

                        <button onclick="app.toggleViewMode()" id="btn-view-mode" class="p-2 rounded-xl transition-all bg-white text-rose-400 hover:text-rose-600 shadow-sm border border-rose-100 hover:border-rose-200">
                            <i data-lucide="eye" class="w-4 h-4"></i>
                        </button>
                    </div>
                </div>

                <!-- √Årea de Conte√∫do -->
                <div class="flex-1 overflow-y-auto relative custom-scrollbar bg-local" id="paper-content-area">
                    
                    <!-- Linha Vertical (Margem) -->
                    <div id="margin-line" class="absolute left-10 md:left-20 top-0 bottom-0 w-px bg-rose-200/50 z-0 h-full pointer-events-none"></div>

                    <div class="max-w-3xl mx-auto min-h-full flex flex-col relative z-10">
                        
                        <!-- Cabe√ßalho Nota -->
                        <div class="px-10 md:px-12 pt-10 pb-6">
                            <input type="text" id="note-title" placeholder="T√≠tulo M√°gico..." class="w-full text-4xl font-bold bg-transparent border-none focus:ring-0 placeholder-rose-200 text-slate-700 px-0 outline-none transition-colors duration-300 font-dancing">
                            
                            <div class="mt-6 flex flex-wrap gap-2 items-center">
                                <div id="tags-container" class="flex flex-wrap gap-2"></div>
                                
                                <div id="add-tag-wrapper" class="flex items-center gap-2 group ml-1 bg-white/50 px-3 py-1 rounded-full border border-transparent hover:border-rose-200 transition-all cursor-text" onclick="document.getElementById('tag-input').focus()">
                                    <i data-lucide="tag" class="w-3 h-3 text-rose-300"></i>
                                    <input type="text" id="tag-input" placeholder="Etiqueta..." class="bg-transparent text-xs font-bold text-rose-500 placeholder-rose-300 focus:outline-none min-w-[60px]">
                                </div>
                            </div>
                        </div>

                        <!-- Editor -->
                        <div class="flex-1 px-10 md:px-12 pb-16 relative">
                            <textarea id="note-content" placeholder="Querido di√°rio..." spellcheck="true" 
                                class="w-full h-full min-h-[500px] resize-none bg-transparent border-none focus:ring-0 px-0 py-0 tracking-wide leading-9 outline-none transition-colors duration-300"></textarea>
                            <div id="note-preview" class="hidden prose prose-lg prose-pink max-w-none whitespace-pre-wrap min-h-[500px]"></div>
                        </div>

                    </div>
                </div>

            </div>
        </div>

    </main>

    <!-- L√≥gica da Aplica√ß√£o -->
    <script>
        // --- Configura√ß√µes Fofas ---
        
        const coverThemes = [
            { id: 'blush', name: 'Blush', icon: 'üéÄ', bg: 'bg-rose-50', gradient: 'from-rose-100 to-rose-200', text: 'text-rose-600', border: 'border-rose-200' },
            { id: 'babyblue', name: 'Nuvem', icon: '‚òÅÔ∏è', bg: 'bg-sky-50', gradient: 'from-sky-100 to-sky-200', text: 'text-sky-600', border: 'border-sky-200' },
            { id: 'lavender', name: 'Sonho', icon: 'ü¶Ñ', bg: 'bg-purple-50', gradient: 'from-purple-100 to-purple-200', text: 'text-purple-600', border: 'border-purple-200' },
            { id: 'mint', name: 'Ch√°', icon: 'üçµ', bg: 'bg-emerald-50', gradient: 'from-emerald-100 to-teal-100', text: 'text-teal-600', border: 'border-emerald-200' },
            { id: 'lemon', name: 'Sol', icon: 'üåª', bg: 'bg-yellow-50', gradient: 'from-yellow-100 to-amber-100', text: 'text-amber-600', border: 'border-yellow-200' },
            { id: 'peach', name: 'P√™ssego', icon: 'üçë', bg: 'bg-orange-50', gradient: 'from-orange-100 to-rose-100', text: 'text-orange-600', border: 'border-orange-200' },
            { id: 'dark', name: 'Lua', icon: 'üåô', bg: 'bg-slate-800', gradient: 'from-slate-700 to-slate-900', text: 'text-indigo-200', border: 'border-slate-700', isDark: true },
        ];

        const fontOptions = {
            dancing: { id: 'dancing', name: 'Dancing', family: '"Dancing Script", cursive', class: 'font-dancing' },
            pacifico: { id: 'pacifico', name: 'Pacifico', family: '"Pacifico", cursive', class: 'font-pacifico' },
            indie: { id: 'indie', name: 'Indie', family: '"Indie Flower", cursive', class: 'font-indie' },
            quicksand: { id: 'quicksand', name: 'Quicksand', family: '"Quicksand", sans-serif', class: 'font-ui' },
            playfair: { id: 'playfair', name: 'Playfair', family: '"Playfair Display", serif', class: 'font-playfair' },
            handwriting: { id: 'handwriting', name: 'Caveat', family: '"Caveat", cursive', class: 'font-handwriting' },
            marker: { id: 'marker', name: 'Marker', family: '"Patrick Hand", cursive', class: 'font-marker' },
            serif: { id: 'serif', name: 'Livro', family: '"Merriweather", serif', class: 'font-serif' },
        };

        const textColors = [
            { id: 'default', color: '#475569', name: 'Cinza' },
            { id: 'black', color: '#000000', name: 'Preto' },
            { id: 'rose', color: '#db2777', name: 'Rosa' },
            { id: 'purple', color: '#9333ea', name: 'Roxo' },
            { id: 'blue', color: '#2563eb', name: 'Azul' },
            { id: 'teal', color: '#0d9488', name: 'Verde' },
            { id: 'cocoa', color: '#78350f', name: 'Cacau' },
        ];

        const paperStyles = {
            lined: {
                label: 'Linhas',
                isDark: false,
                css: {
                    backgroundImage: 'linear-gradient(transparent 35px, #e2e8f0 35px)',
                    backgroundSize: '100% 36px',
                    lineHeight: '36px',
                    backgroundColor: '#ffffff'
                }
            },
            grid: {
                label: 'Quadros',
                isDark: false,
                css: {
                    backgroundImage: 'linear-gradient(#f1f5f9 1px, transparent 1px), linear-gradient(90deg, #f1f5f9 1px, transparent 1px)',
                    backgroundSize: '24px 24px',
                    lineHeight: '36px',
                    backgroundColor: '#ffffff'
                }
            },
            dots: {
                label: 'Pontos',
                isDark: false,
                css: {
                    backgroundImage: 'radial-gradient(#cbd5e1 1.5px, transparent 1.5px)',
                    backgroundSize: '24px 24px',
                    lineHeight: '36px',
                    backgroundColor: '#ffffff'
                }
            },
            pink: {
                label: 'Rosa',
                isDark: false,
                css: {
                    backgroundColor: '#fff1f2',
                    backgroundImage: 'linear-gradient(transparent 35px, #fecdd3 35px)',
                    backgroundSize: '100% 36px',
                    lineHeight: '36px'
                }
            },
            cream: {
                label: 'Creme',
                isDark: false,
                css: {
                    backgroundColor: '#fffbeb',
                    backgroundImage: 'url("https://www.transparenttextures.com/patterns/cream-paper.png")',
                    lineHeight: '36px'
                }
            }
        };

        // Estado da Aplica√ß√£o
        const app = {
            notes: [],
            activeNoteId: null,
            searchQuery: '',
            viewMode: 'edit',
            enableSpellcheck: true, // Novo estado para o corretor
            
            init() {
                const saved = localStorage.getItem('smart-notebook-cute-v3');
                // Carregar prefer√™ncia do corretor se existir (ou usar true por defeito)
                const savedSpellcheck = localStorage.getItem('smart-notebook-spellcheck');
                this.enableSpellcheck = savedSpellcheck !== null ? JSON.parse(savedSpellcheck) : true;

                if (saved) {
                    this.notes = JSON.parse(saved);
                } else {
                    this.notes = [
                        {
                            id: '1',
                            title: 'Meus Sonhos ‚ú®',
                            content: 'Coisas que quero fazer este ano:\n\n1. Aprender a fazer cookies üç™\n2. Plantar um jardim üå∏\n3. Ler 12 livros de fantasia\n\n"Acredita na magia dos novos come√ßos."',
                            tags: ['sonhos', '2025'],
                            theme: 'blush',
                            paper: 'pink',
                            font: 'dancing',
                            fontSize: 26,
                            textColor: '#db2777', // Rosa
                            updatedAt: new Date().toISOString(),
                        },
                        {
                            id: '2',
                            title: 'Ideias de Presentes üéÅ',
                            content: 'Para a m√£e: Um colar de prata\nPara o pai: Livro de hist√≥ria\nPara mim: Cadernos novos!',
                            tags: ['compras', 'amor'],
                            theme: 'babyblue',
                            paper: 'grid',
                            font: 'indie',
                            fontSize: 22,
                            textColor: '#475569',
                            updatedAt: new Date(Date.now() - 86400000).toISOString(),
                        }
                    ];
                }
                
                if (this.notes.length > 0) {
                    this.activeNoteId = this.notes[0].id;
                }

                document.getElementById('search-input').addEventListener('input', (e) => {
                    this.searchQuery = e.target.value;
                    this.renderSidebar();
                });

                document.getElementById('note-title').addEventListener('input', (e) => this.updateNote('title', e.target.value));
                document.getElementById('note-content').addEventListener('input', (e) => this.updateNote('content', e.target.value));
                
                document.getElementById('tag-input').addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' && e.target.value.trim()) {
                        this.addTag(e.target.value.trim());
                        e.target.value = '';
                    }
                });

                this.renderSidebar();
                this.renderMain();
                this.renderMenu();
                lucide.createIcons();
            },

            save() {
                localStorage.setItem('smart-notebook-cute-v3', JSON.stringify(this.notes));
            },

            addNote() {
                const newNote = {
                    id: Date.now().toString(),
                    title: '',
                    content: '',
                    tags: [],
                    theme: 'blush',
                    paper: 'lined',
                    font: 'quicksand',
                    fontSize: 22,
                    textColor: '#475569',
                    updatedAt: new Date().toISOString(),
                };
                this.notes.unshift(newNote);
                this.activeNoteId = newNote.id;
                this.viewMode = 'edit';
                
                if (window.innerWidth < 768) this.toggleSidebar();
                
                this.save();
                this.renderSidebar();
                this.renderMain();
            },

            updateNote(key, value) {
                const note = this.notes.find(n => n.id === this.activeNoteId);
                if (note) {
                    note[key] = value;
                    note.updatedAt = new Date().toISOString();
                    this.save();
                    
                    if (key === 'title' || key === 'tags' || key === 'theme') {
                        this.renderSidebar();
                    }
                    if (['fontSize', 'font', 'paper', 'textColor', 'theme'].includes(key)) {
                        this.renderMain();
                    }
                    
                    if (!document.getElementById('appearance-menu').classList.contains('hidden')) {
                        this.renderMenu();
                    }
                }
            },

            deleteNote(e, id) {
                e.stopPropagation();
                if(!confirm("Apagar esta p√°gina fofinha? ü•∫")) return;

                this.notes = this.notes.filter(n => n.id !== id);
                if (this.activeNoteId === id) {
                    this.activeNoteId = this.notes.length > 0 ? this.notes[0].id : null;
                }
                this.save();
                this.renderSidebar();
                this.renderMain();
            },

            selectNote(id) {
                this.activeNoteId = id;
                this.viewMode = 'edit';
                if (window.innerWidth < 768) this.toggleSidebar();
                this.renderSidebar();
                this.renderMain();
            },

            addTag(tag) {
                const note = this.notes.find(n => n.id === this.activeNoteId);
                const normalizedTag = tag.toLowerCase();
                if (note && !note.tags.includes(normalizedTag)) {
                    this.updateNote('tags', [...note.tags, normalizedTag]);
                    this.renderTags();
                }
            },

            removeTag(tag) {
                const note = this.notes.find(n => n.id === this.activeNoteId);
                if (note) {
                    this.updateNote('tags', note.tags.filter(t => t !== tag));
                    this.renderTags();
                }
            },

            toggleSidebar() {
                const sidebar = document.getElementById('sidebar');
                sidebar.classList.toggle('-translate-x-full');
            },

            toggleViewMode() {
                this.viewMode = this.viewMode === 'edit' ? 'preview' : 'edit';
                this.renderMain();
            },

            toggleAppearanceMenu() {
                const menu = document.getElementById('appearance-menu');
                const btn = document.getElementById('btn-personalizar');
                
                menu.classList.toggle('hidden');
                btn.classList.toggle('bg-rose-50');
                
                if (!menu.classList.contains('hidden')) {
                    this.renderMenu(); 
                }
            },

            toggleSpellcheck() {
                this.enableSpellcheck = !this.enableSpellcheck;
                localStorage.setItem('smart-notebook-spellcheck', JSON.stringify(this.enableSpellcheck));
                this.renderMain();
                // Atualizar o menu para refletir a mudan√ßa visualmente
                this.renderMenu();
            },

            changeFontSize(delta) {
                const note = this.notes.find(n => n.id === this.activeNoteId);
                if (note) {
                    const current = note.fontSize || 22;
                    const newSize = Math.max(14, Math.min(48, current + delta));
                    this.updateNote('fontSize', newSize);
                }
            },

            renderSidebar() {
                const list = document.getElementById('notes-list');
                const activeTheme = this.getActiveNoteTheme();
                
                const headerIconContainer = document.getElementById('sidebar-icon-container');
                const appIcon = document.getElementById('app-icon');
                
                if(activeTheme) {
                    headerIconContainer.className = `w-14 h-14 rounded-full flex items-center justify-center text-3xl shadow-sm ring-4 ring-white transition-all duration-500 bg-gradient-to-br ${activeTheme.gradient} text-white`;
                    appIcon.textContent = activeTheme.icon;
                }

                list.innerHTML = '';

                const filtered = this.notes.filter(n => {
                    const q = this.searchQuery.toLowerCase();
                    return n.title.toLowerCase().includes(q) || n.content.toLowerCase().includes(q) || n.tags.some(t => t.includes(q));
                }).sort((a, b) => new Date(b.updatedAt) - new Date(a.updatedAt));

                if (filtered.length === 0) {
                    list.innerHTML = `
                        <div class="text-center py-10 text-rose-300 opacity-60">
                            <i data-lucide="ghost" class="w-8 h-8 mx-auto mb-2"></i>
                            <p class="text-sm font-medium">Vazio...</p>
                        </div>
                    `;
                    lucide.createIcons();
                    return;
                }

                filtered.forEach(note => {
                    const theme = coverThemes.find(t => t.id === (note.theme || 'blush'));
                    const isActive = note.id === this.activeNoteId;
                    const date = new Intl.DateTimeFormat('pt-PT', { day: 'numeric', month: 'short' }).format(new Date(note.updatedAt));

                    const div = document.createElement('div');
                    div.className = `p-4 rounded-3xl cursor-pointer transition-all relative group mb-3 border-2 ${
                        isActive 
                        ? `bg-white border-${theme.text.split('-')[1]}-200 shadow-[0_8px_20px_-5px_rgba(0,0,0,0.1)] scale-[1.02]` 
                        : 'bg-white/50 border-transparent hover:bg-white hover:border-rose-100 hover:scale-[1.01]'
                    }`;
                    div.onclick = () => this.selectNote(note.id);

                    div.innerHTML = `
                        <div class="flex justify-between items-start mb-2">
                            <h3 class="font-bold text-sm line-clamp-1 font-ui ${isActive ? 'text-slate-800' : 'text-slate-600'}">
                                ${theme.icon} ${note.title || 'Sem t√≠tulo'}
                            </h3>
                            <span class="text-[10px] font-bold px-2 py-1 rounded-full ${isActive ? 'bg-rose-100 text-rose-500' : 'text-slate-300'}">
                                ${date}
                            </span>
                        </div>
                        <p class="text-xs line-clamp-2 mb-3 leading-relaxed font-ui ${isActive ? 'text-slate-500' : 'text-slate-400'}">
                            ${note.content || '...'}
                        </p>
                        <div class="flex items-center justify-between">
                            <div class="flex flex-wrap gap-1">
                                ${note.tags.slice(0, 2).map(tag => `
                                    <span class="text-[10px] px-2 py-0.5 rounded-full font-bold text-slate-400 bg-slate-100/50">#${tag}</span>
                                `).join('')}
                            </div>
                            <button onclick="app.deleteNote(event, '${note.id}')" class="p-1.5 rounded-full text-rose-300 hover:text-rose-500 hover:bg-rose-50 opacity-0 group-hover:opacity-100 transition-all">
                                <i data-lucide="trash-2" class="w-3 h-3"></i>
                            </button>
                        </div>
                    `;
                    list.appendChild(div);
                });
                lucide.createIcons();
            },

            renderMain() {
                const emptyState = document.getElementById('empty-state');
                const editorContainer = document.getElementById('editor-container');
                const note = this.notes.find(n => n.id === this.activeNoteId);

                if (!note) {
                    emptyState.classList.remove('hidden');
                    editorContainer.classList.add('hidden');
                    return;
                }

                emptyState.classList.add('hidden');
                editorContainer.classList.remove('hidden');

                // Aplicar Dados
                document.getElementById('note-title').value = note.title;
                document.getElementById('last-updated').innerText = new Intl.DateTimeFormat('pt-PT', { day: 'numeric', month: 'short', hour:'2-digit', minute:'2-digit' }).format(new Date(note.updatedAt));
                
                const theme = coverThemes.find(t => t.id === (note.theme || 'blush'));
                const paper = paperStyles[note.paper || 'lined'];
                const font = fontOptions[note.font || 'quicksand'];
                const fontSize = note.fontSize || 22;
                const textColor = note.textColor || '#475569';

                // Icons Toolbar
                const toolbarIconBg = document.getElementById('toolbar-icon-bg');
                toolbarIconBg.className = `w-11 h-11 rounded-2xl flex items-center justify-center text-2xl shadow-sm ring-4 ring-white transition-all bg-gradient-to-br ${theme.gradient} text-white`;
                document.getElementById('toolbar-icon').innerText = theme.icon;
                document.getElementById('paper-label').innerText = paper.label;

                // Margem
                const margin = document.getElementById('margin-line');
                margin.style.display = (note.paper === 'lined' || note.paper === 'pink') ? 'block' : 'none';

                // Content Area
                const textarea = document.getElementById('note-content');
                const preview = document.getElementById('note-preview');
                const tagWrapper = document.getElementById('add-tag-wrapper');
                const titleInput = document.getElementById('note-title');

                // Aplicar defini√ß√£o do corretor
                textarea.spellcheck = this.enableSpellcheck;

                // Reset function to clear previous styles
                const resetBackground = (el) => {
                    el.style.backgroundImage = '';
                    el.style.backgroundColor = '';
                    el.style.backgroundSize = '';
                    el.style.backgroundAttachment = '';
                };

                // Aplicar estilos din√¢micos
                const styles = {
                    fontFamily: font.family,
                    fontSize: `${fontSize}px`,
                    color: textColor,
                    ...paper.css
                };

                const applyStyles = (el) => {
                    resetBackground(el);
                    Object.assign(el.style, styles);
                };
                
                titleInput.style.fontFamily = font.family;
                titleInput.style.color = textColor;

                if (this.viewMode === 'edit') {
                    textarea.value = note.content;
                    textarea.classList.remove('hidden');
                    preview.classList.add('hidden');
                    tagWrapper.classList.remove('hidden');
                    titleInput.disabled = false;
                    applyStyles(textarea);
                    document.getElementById('btn-view-mode').innerHTML = '<i data-lucide="eye" class="w-4 h-4"></i>';
                } else {
                    preview.innerText = note.content;
                    textarea.classList.add('hidden');
                    preview.classList.remove('hidden');
                    tagWrapper.classList.add('hidden');
                    titleInput.disabled = true;
                    applyStyles(preview);
                    document.getElementById('btn-view-mode').innerHTML = '<i data-lucide="pencil" class="w-4 h-4"></i>';
                }

                this.renderTags();
                lucide.createIcons();
            },

            renderTags() {
                const container = document.getElementById('tags-container');
                const note = this.notes.find(n => n.id === this.activeNoteId);
                const theme = coverThemes.find(t => t.id === (note?.theme || 'blush'));
                
                container.innerHTML = '';
                
                if (note) {
                    note.tags.forEach(tag => {
                        const span = document.createElement('span');
                        span.className = `inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-bold text-rose-500 bg-rose-50 cursor-pointer hover:bg-rose-100 transition-colors border-2 border-rose-100 hover:border-rose-200`;
                        span.innerText = `#${tag}`;
                        span.onclick = () => this.removeTag(tag);
                        container.appendChild(span);
                    });
                }
            },

            renderMenu() {
                const menu = document.getElementById('appearance-menu');
                const note = this.notes.find(n => n.id === this.activeNoteId);
                if (!note) return;

                const sectionTitle = (text) => `
                    <div class="flex items-center gap-2 mb-3 mt-1">
                        <span class="text-[10px] font-bold text-rose-300 uppercase tracking-widest">${text}</span>
                        <div class="h-px bg-rose-100 flex-1"></div>
                    </div>
                `;

                // 1. Temas
                let html = sectionTitle('Capa & Tema');
                html += '<div class="flex gap-2 mb-5 overflow-x-auto pb-2 no-scrollbar">';
                coverThemes.forEach(t => {
                    const isSelected = note.theme === t.id;
                    html += `
                        <button onclick="app.updateNote('theme', '${t.id}')" 
                            class="flex-shrink-0 w-9 h-9 rounded-full flex items-center justify-center text-sm transition-all bg-gradient-to-br ${t.gradient} ${isSelected ? 'ring-2 ring-offset-2 ring-rose-300 scale-110' : 'opacity-70 hover:opacity-100 hover:scale-105'} text-white shadow-sm" 
                            title="${t.name}">
                            ${t.icon}
                        </button>
                    `;
                });
                html += '</div>';

                // 2. Papel
                html += sectionTitle('Papel');
                html += '<div class="grid grid-cols-2 gap-2 mb-5">';
                for (const [key, style] of Object.entries(paperStyles)) {
                    const isSelected = note.paper === key;
                    html += `
                        <button onclick="app.updateNote('paper', '${key}')" 
                            class="text-xs font-bold py-2 px-3 rounded-xl border-2 transition-all flex items-center justify-center gap-2 ${isSelected ? 'border-rose-300 bg-rose-50 text-rose-600' : 'border-slate-100 text-slate-400 hover:border-rose-100 hover:text-slate-500'}">
                            ${style.label}
                        </button>
                    `;
                }
                html += '</div>';

                // 3. Fonte Familia
                html += sectionTitle('Tipografia');
                html += '<div class="grid grid-cols-2 gap-2 mb-3">';
                for (const [key, font] of Object.entries(fontOptions)) {
                    const isSelected = note.font === key;
                    html += `
                        <button onclick="app.updateNote('font', '${key}')" 
                            class="text-sm py-1.5 rounded-lg transition-all ${isSelected ? 'bg-rose-500 text-white shadow-md' : 'text-slate-500 hover:bg-slate-50'}" 
                            style="font-family: ${font.family}">
                            ${font.name}
                        </button>
                    `;
                }
                html += '</div>';

                // 4. Cores e Tamanho
                html += '<div class="flex items-center justify-between gap-4 mb-4">';
                
                // Cores
                html += '<div class="flex gap-1">';
                textColors.forEach(c => {
                   const isSelected = (note.textColor || '#475569') === c.color;
                   html += `
                        <button onclick="app.updateNote('textColor', '${c.color}')"
                            class="w-5 h-5 rounded-full border border-slate-100 ${isSelected ? 'ring-2 ring-offset-1 ring-slate-300' : 'hover:scale-110'}"
                            style="background-color: ${c.color}"
                            title="${c.name}"
                        ></button>
                   `; 
                });
                html += '</div>';

                // Tamanho
                html += `
                    <div class="flex items-center bg-slate-50 rounded-lg p-1 border border-slate-100">
                        <button onclick="app.changeFontSize(-2)" class="w-6 h-6 flex items-center justify-center hover:bg-white rounded text-slate-400 hover:text-rose-500"><i data-lucide="minus" class="w-3 h-3"></i></button>
                        <span class="text-xs font-bold text-slate-600 w-6 text-center">${note.fontSize || 22}</span>
                        <button onclick="app.changeFontSize(2)" class="w-6 h-6 flex items-center justify-center hover:bg-white rounded text-slate-400 hover:text-rose-500"><i data-lucide="plus" class="w-3 h-3"></i></button>
                    </div>
                `;
                html += '</div>';

                // 5. Corretor
                html += `
                    <div class="pt-2 border-t border-rose-50">
                        <button onclick="app.toggleSpellcheck()" class="w-full flex items-center justify-between p-2 rounded-lg hover:bg-rose-50 transition-colors group">
                            <div class="flex items-center gap-2">
                                <i data-lucide="${this.enableSpellcheck ? 'check-circle-2' : 'circle'}" class="w-4 h-4 ${this.enableSpellcheck ? 'text-green-500' : 'text-slate-300'}"></i>
                                <span class="text-xs font-bold text-slate-500 group-hover:text-rose-500">Corretor Ortogr√°fico</span>
                            </div>
                            <span class="text-[10px] font-bold ${this.enableSpellcheck ? 'text-green-500 bg-green-50' : 'text-slate-400 bg-slate-100'} px-2 py-0.5 rounded-full">
                                ${this.enableSpellcheck ? 'LIGADO' : 'DESLIGADO'}
                            </span>
                        </button>
                    </div>
                `;

                menu.innerHTML = html;
                lucide.createIcons();
            },

            getActiveNoteTheme() {
                const note = this.notes.find(n => n.id === this.activeNoteId);
                return note ? coverThemes.find(t => t.id === (note.theme || 'blush')) : null;
            }
        };

        // Inicializar
        window.onload = () => app.init();

    </script>
</body>
</html>
